<!-- frontend/partials/header-admin.html -->
<link
  rel="stylesheet"
  href="/restaurant-app/frontend/assets/vendor/bootstrap/bootstrap.min.css"
/>

<style>
  .navbar {
    box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
  }
  .nav-link {
    color: #adb5bd;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
    border-radius: 6px;
    padding: 6px 12px;
    transition: all 0.25s ease;
  }
  .nav-link:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.1);
  }
  .nav-link.active {
    color: #fff !important;
    background: #0d6efd;
    font-weight: 600;
    box-shadow: 0 3px 8px rgba(13, 110, 253, 0.3);
  }

  .avatar-badge {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    background: #0d6efd;
    color: #fff;
    display: grid;
    place-items: center;
    font-weight: 700;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
    transition: transform 0.2s ease;
  }
  .avatar-badge:hover {
    transform: scale(1.1);
  }

  .dropdown-menu .dropdown-item {
    transition: background 0.2s ease, color 0.2s ease;
  }
  .dropdown-menu .dropdown-item:hover {
    background: #0d6efd;
    color: #fff;
  }
</style>

<header class="sticky-top">
  <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
    <div class="container">
      <!-- Brand -->
      <a class="navbar-brand fw-bold d-flex align-items-center gap-2" id="adminBrand" href="#">
        <i class="bi bi-shield-lock-fill"></i> Admin Panel
      </a>

      <!-- Mobile Toggler -->
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#adminNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Navbar Links -->
      <div class="collapse navbar-collapse" id="adminNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="navAdminLeft">
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/admin-dashboard.php">
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/admin-orders.php">
              Orders
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/admin-reservations.php">
             Reservations
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/admin-menu.php">
               Menu
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/admin-tables.php">
               Tables
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/admin-reviews.php">
              Reviews
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-href="/frontend/pages/admin-gallery.php">
               Gallery
            </a>
          </li>
        </ul>

        <!-- User Dropdown -->
        <div class="dropdown">
          <button
            class="btn btn-outline-light d-flex align-items-center gap-2 dropdown-toggle"
            data-bs-toggle="dropdown"
          >
            <span class="avatar-badge">A</span>
            <span id="adminName" class="fw-semibold">Admin</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end shadow-sm">
            <li>
              <a class="dropdown-item" id="backToSite">
                <i class="bi bi-house-door me-2"></i> Back to Site
              </a>
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <button id="btnLogout" class="dropdown-item text-danger fw-semibold">
                <i class="bi bi-box-arrow-right me-2"></i> Logout
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  (function () {
    if (!window.APP_BASE) {
      var p = location.pathname.split("/");
      var i = p.indexOf("restaurant-app");
      window.APP_BASE = i >= 0 ? "/" + p.slice(1, i + 1).join("/") : "";
    }
  })();

  function href(el, path) {
    if (el) el.href = window.APP_BASE + path;
  }
  function getUser() {
    try {
      return JSON.parse(localStorage.getItem("cr_user") || "null");
    } catch {
      return null;
    }
  }

  (function guardAndWire() {
    var u = getUser(),
      isAdmin = !!(u && (u.role || "").toLowerCase() === "admin");
    if (!isAdmin) {
      location.replace(window.APP_BASE + "/index.php?unauthorized=1");
      return;
    }

    // Avatar & Name
    var badge = document.querySelector(".avatar-badge");
    if (badge)
      badge.textContent = (u.name || "A").trim().charAt(0).toUpperCase() || "A";
    var adm = document.getElementById("adminName");
    if (adm) adm.textContent = u.name || "Admin";

    // Links
    href(document.getElementById("adminBrand"), "/frontend/pages/admin-dashboard.php");
    document
      .querySelectorAll("#navAdminLeft a[data-href]")
      .forEach((a) => href(a, a.getAttribute("data-href")));
    href(document.getElementById("backToSite"), "/index.php");

    // Highlight active link
    var path = location.pathname.replace(/\/+$/, "");
    document.querySelectorAll("#navAdminLeft .nav-link").forEach((a) => {
      var hp = (a.getAttribute("href") || "").replace(/\/+$/, "");
      a.classList.toggle("active", hp === path);
    });

    // Logout
    var btnLogout = document.getElementById("btnLogout");
    if (btnLogout) {
      btnLogout.addEventListener("click", () => {
        localStorage.removeItem("cr_user");
        location.href = window.APP_BASE + "/index.php";
      });
    }
  })();
</script>
